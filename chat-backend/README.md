# Chat Backend (WhatsApp-like)

Легкий сервер с REST + WebSocket для мобильного клиента, имитирует базовую логику WhatsApp.

## Возможности
- Авторизация по номеру телефона через фиктивный код `0000`.
- Создание пользователя при первом входе.
- Список чатов и контактов.
- Отправка и получение сообщений в реальном времени через Socket.IO.
- Обновление имени и статуса профиля.

## Быстрый старт
1. Скопируйте `.env.example` в `.env` и при необходимости измените порты/URL фронтенда.
2. Установите зависимости:
   ```bash
   cd chat-backend
   npm install
   ```
3. Запустите сервер в режиме разработки:
   ```bash
   npm run dev
   ```
   API и Socket.IO будут доступны на `http://localhost:5000`.

## REST API
- `POST /auth/request-code` — принимает `phone`, возвращает фиктивный код.
- `POST /auth/confirm` — принимает `phone` и `code=0000`, создает/находит пользователя и возвращает JWT + профиль.
- `GET /me` — текущий пользователь (требуется `Authorization: Bearer <token>`).
- `PUT /me` — обновление `name` и/или `status`.
- `GET /contacts` — список пользователей для выбора собеседника.
- `GET /chats` — чаты текущего пользователя с последним сообщением.
- `POST /chats` — создание/поиск диалога по `userId`.
- `GET /chats/:id/messages` — сообщения с пагинацией через `limit`/`offset`.
- `POST /chats/:id/messages` — отправка сообщения.

## WebSocket (Socket.IO)
- Подключение: `io('http://localhost:5000', { auth: { token } })`.
- `message` — новое сообщение в чате, payload: `{ message }`.
- `send_message` — отправка сообщения из клиента `{ chatId, text }`.
- `join_chat` — подписка на чат по `chatId` (авторизованный пользователь автоматически добавляется в свои чаты при коннекте).

> Данные хранятся в памяти процесса и сбрасываются при перезапуске. Структура отражает модели User, Chat, Message и связи many-to-many между чатами и пользователями.
